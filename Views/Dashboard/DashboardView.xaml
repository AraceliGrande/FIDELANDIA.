<UserControl x:Class="FIDELANDIA.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:local="clr-namespace:FIDELANDIA.Views">

    <Border CornerRadius="12" Padding="10">

        <DockPanel LastChildFill="True">

            <Border VerticalAlignment="Center" Effect="{StaticResource DropShadow}" DockPanel.Dock="Top" CornerRadius="10" Background="White"  BorderBrush="#eee" BorderThickness="0.5" Opacity="1" Padding="20" Margin="6,0,6,10">

                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel VerticalAlignment="Center" Margin="10">
                        <TextBlock Text="Tablero de control de producción" FontSize="17" FontWeight="Bold" Foreground="#8C3000"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="10,0,0,0">
                        <Border Margin="0,0,6,0">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Desde:" VerticalAlignment="Center" Foreground="#666" FontSize="12" Margin="0,0,4,0"/>
                                <DatePicker x:Name="FechaDesdePicker"  Style="{StaticResource UnderlineDatePicker}"
                         SelectedDate="{Binding FechaDesde, Mode=TwoWay}"
                         Width="120"/>
                            </StackPanel>
                        </Border>

                        <Border Margin="35,0,35,0">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Hasta:" VerticalAlignment="Center" Foreground="#666" FontSize="12" Margin="0,0,4,0"/>
                                <DatePicker x:Name="FechaHastaPicker"  Style="{StaticResource UnderlineDatePicker}"
                         SelectedDate="{Binding FechaHasta, Mode=TwoWay}"
                         Width="120"/>
                            </StackPanel>
                        </Border>

                        <Border Margin="10,0,30,0">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Tiempo:" VerticalAlignment="Center" Foreground="#666" FontSize="12" Margin="0,0,4,0"/>
                                <ComboBox x:Name="CboAgrupacion" Width="150">
                                    <ComboBoxItem Content="Día" Tag="Dia" />
                                    <ComboBoxItem Content="Mes" Tag="Mes" />
                                </ComboBox>
                            </StackPanel>
                        </Border>


                        <Button Content="Filtrar" Click="Filtrar_Click" Style="{StaticResource PrimaryButton}" Cursor="Hand" Width="100"  Height="35" />

                    </StackPanel>

                </Grid>
            </Border>

            <!-- ======================= CONTENIDO PRINCIPAL ======================= -->
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">

                <Grid>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="1.2*"/>
                        <RowDefinition Height="3*"/>
                        <RowDefinition Height="2.5*"/>
                        <RowDefinition Height="2.5*"/>
                        <RowDefinition Height="1.5*"/>
                        <RowDefinition Height="1.5*"/>
                        <RowDefinition Height="AUTO"/>
                    </Grid.RowDefinitions>

                    <!-- ===================== MÉTRICAS (CARDS) ===================== -->
                    <UniformGrid Grid.Row="0" Columns="4" HorizontalAlignment="Stretch" Margin="0">
                        <!-- Producción Total -->
                        <Border Background="White" CornerRadius="16" Padding="6" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="Producción (Envases)" FontSize="12" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                                <TextBlock Text="{Binding CantidadProducida, StringFormat=N0}" FontSize="18" FontWeight="Bold" Foreground="#2D3436" Margin="0,3,0,0" TextAlignment="Center"/>
                                <TextBlock Text="{Binding VariacionProduccionText}" Foreground="{Binding VariacionProduccionColor}" FontSize="12" TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding VariacionProduccionText}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Ventas Totales -->
                        <Border Background="White" CornerRadius="16" Padding="6" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="Ventas Totales" FontSize="12" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                                <TextBlock Text="{Binding VentasTotales, StringFormat=N0}" FontSize="18" FontWeight="Bold" Foreground="#2D3436" Margin="0,3,0,0" TextAlignment="Center"/>
                                <TextBlock Text="{Binding VariacionVentasText}" Foreground="{Binding VariacionVentasColor}" FontSize="12" TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding VariacionVentasText}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Stock Promedio -->
                        <Border Background="White" CornerRadius="16" Padding="6" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="Produccion (Kg)" FontSize="12" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                                <TextBlock Text="{Binding CantidadProducidaKg, StringFormat=N0}" FontSize="18" FontWeight="Bold" Foreground="#2D3436" Margin="0,3,0,0" TextAlignment="Center"/>
                                <TextBlock Text="{Binding VariacionCantidadProduccionKgText}" Foreground="{Binding VariacionCantidadProduccionKgColor}"  FontSize="12" TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding VariacionCantidadProduccionKgText}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>

                        <!-- Ticket Promedio -->
                        <Border Background="White" CornerRadius="16" Padding="6" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                <TextBlock Text="Ticket Promedio" FontSize="12" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                                <TextBlock Text="{Binding TicketPromedio, StringFormat=C}" FontSize="18" FontWeight="Bold" Foreground="#2D3436" Margin="0,3,0,0" TextAlignment="Center"/>
                                <TextBlock Text="{Binding VariacionTicketText}" Foreground="{Binding VariacionTicketColor}" FontSize="12" TextAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding VariacionTicketText}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </UniformGrid>
                    <!-- ===================== GRÁFICOS PRINCIPALES ===================== -->
                    <Grid Grid.Row="1" Margin="0,0,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="2.5*"/>
                            <ColumnDefinition Width="1.5*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Gráfico principal -->
                        <Border Grid.Column="0" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text=" Producción y ventas por tipo de pasta"
                                       FontSize="13"
                                       FontWeight="SemiBold"
                                       Margin="0,0,0,10"
                                       Foreground="#333"/>
                                <lvc:CartesianChart Series="{Binding ProduccionPorTipoSeries}" Height="180" Foreground="#333" HorizontalAlignment="Stretch" Margin="2,20,5,2">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Labels="{Binding TipoPastaLabels}" Title="Tipo de pasta">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1" />
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                </lvc:CartesianChart>

                            </StackPanel>
                        </Border>

                        <!-- PieChart -->
                        <Border Grid.Column="1" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Participación de Ventas" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="#333"/>
                                <lvc:PieChart Series="{Binding ParticipacionVentasSeries}" LegendLocation="Bottom" Height="150" InnerRadius="5" Foreground="#333"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- ===================== COMPARACIÓN HISTÓRICA ===================== -->
                    <Grid Grid.Row="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Gráfico 1 -->
                        <Border Grid.Column="0" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Evolucion de envases producidos" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="#333"/>
                                <lvc:CartesianChart Series="{Binding ProduccionTotalSeries}" Height="145" Foreground="#333" HorizontalAlignment="Stretch" Margin="2,10,5,2">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Tiempo" Labels="{Binding MesesLabels}" ShowLabels="False">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1"/>
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>


                        <!-- Gráfico 2 -->
                        <Border Grid.Column="1" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Evolucion de ventas realizadas" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="#333"/>
                                <lvc:CartesianChart Series="{Binding RendimientoSeries}" Height="145" Foreground="#333" HorizontalAlignment="Stretch" Margin="2,10,5,2">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Tiempo" Labels="{Binding MesesLabels}" ShowLabels="False">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1"/>
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>
                    </Grid>
                    <Grid Grid.Row="3">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Gráfico 3 -->
                        <Border Grid.Column="0" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Cantidad de kg producidos" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="#333"/>
                                <lvc:CartesianChart Series="{Binding LoteComparativoSeries}" Height="145" Foreground="#333" HorizontalAlignment="Stretch" Margin="2,10,5,2">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Tiempo" Labels="{Binding MesesLabels}" ShowLabels="False">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1"/>
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>


                        <!-- Gráfico 4 -->
                        <Border Grid.Column="1" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Recaudacion generada" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="#333"/>
                                <lvc:CartesianChart Series="{Binding TipoSeries}" Height="145" Foreground="#333" HorizontalAlignment="Stretch" Margin="2,10,5,2">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Tiempo" Labels="{Binding MesesLabels}" ShowLabels="False">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1"/>
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>
                    </Grid>
                    <Grid Grid.Row="4">
                        <Border Grid.Row="7" Background="White" CornerRadius="16" Margin="5" Padding="15" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Producción vs Ventas (Envases)" FontSize="13" FontWeight="SemiBold" Margin="0,0,0,10" Foreground="#333"/>
                                <lvc:CartesianChart Series="{Binding ProduccionVsVentasSeries}" Height="200" Foreground="#333" HorizontalAlignment="Stretch" Margin="20,10">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Tiempo" Labels="{Binding MesesLabels}" ShowLabels="False">
                                            <lvc:Axis.Separator>
                                                <lvc:Separator Step="1"/>
                                            </lvc:Axis.Separator>
                                        </lvc:Axis>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Cantidad"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>
                    </Grid>
                    <Grid Grid.Row="5" HorizontalAlignment="Center" Margin="0,20,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1*"/>
                        </Grid.ColumnDefinitions>

                        <Button Content="Administrar base de datos" 
                                    Click="BtnTamanioBaseDatos"
                                    Style="{StaticResource SecondaryButton}" 
                                    Cursor="Hand"
                                    Height="35"
                                    MinWidth="200"
                                    Margin="10,0,10,0"
                                    Grid.Column="2" />      

                    </Grid>
                    <!-- PANEL ESTADO DE BASE DE DATOS - OCULTO AL INICIO -->
                    <Grid Grid.Row="6" x:Name="PanelBaseDatos" Visibility="Collapsed" Margin="0,25,0,10">
                        <Border Background="White" CornerRadius="16" Padding="20" Margin="10" BorderBrush="#ddd" BorderThickness="1" HorizontalAlignment="Stretch">
                            <StackPanel HorizontalAlignment="Center" Width="Auto">

                                <!-- TITULO -->
                                <TextBlock Text="Estado de la Base de Datos" FontSize="18" FontWeight="Bold" Foreground="#2D3436" Margin="0,0,0,15" TextAlignment="Center"/>

                                <!-- INFORMACIÓN DETALLADA -->
                                <StackPanel Margin="0,5,0,15">
                                    <TextBlock Text="Límite permitido (SQL Express): 9 GB" FontSize="13" Foreground="#555" Margin="0,3"/>
                                    <TextBlock Text="{Binding BaseDatosGBTexto, StringFormat=Espacio usado: {0}}" FontSize="13" Foreground="#555" Margin="0,3"/>
                                    <TextBlock x:Name="TxtEstadoBD" Text="Estado: Analizando..." FontSize="13" FontWeight="SemiBold" Foreground="#333" Margin="0,5"/>
                                </StackPanel>

                                <!-- GRAFICO -->
                                <lvc:PieChart Series="{Binding BaseDatosPieSeries}" Height="170" Width="170" InnerRadius="70" LegendLocation="None" Margin="0,10" Foreground="#333"/>

                                <!-- RECOMENDACION -->
                                <TextBlock Text="Recomendación:" FontSize="15" FontWeight="Bold" Foreground="#2d3436" Margin="0,15,0,5"/>
                                <TextBlock x:Name="TxtRecomendacion" Text="Analizando..." FontSize="13" Foreground="#666" TextAlignment="Center" TextWrapping="Wrap" Margin="20,0,20,10"/>

                                <!-- BOTONES DE ACCIÓN -->
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,15,0,0">
                                    <Button Content="Exportar producción y ventas" Width="190" Height="35" Margin="5" Click="BtnExportarBackupProduccionVentas_Click" Style="{StaticResource SecondaryButton}"/>
                                    <Button Content="Exportar proveedores" Width="190" Height="35" Margin="5" Click="BtnExportarBackupProveedoresTransacciones_Click" Style="{StaticResource SecondaryButton}"/>
                                    <Button Content="Vaciar producción/ventas" Width="190" Height="35" Margin="5"
                                      Click="BtnVaciarProduccionVentas_Click" Style="{StaticResource SecondaryButton}"/>

                                    <Button Content="Vaciar transacciones" Width="160" Height="35" Margin="5"
                                     Click="BtnVaciarTransacciones_Click" Style="{StaticResource SecondaryButton}"/>

                                </StackPanel>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,15,0,0">
                                    <Button Content="Vaciar base de datos" Width="160" Height="35" Margin="5" Click="BtnBorrarBaseDatos" Style="{StaticResource SecondaryButton}"/>
                                </StackPanel>

                                <!-- BOTON CERRAR -->
                                <Button Content="Cerrar" Width="150" Height="32" Margin="0,25,0,0" Click="BtnCerrarPanelBaseDatos_Click" Style="{StaticResource SecondaryButton}"/>

                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </ScrollViewer>
        </DockPanel>
    </Border>
</UserControl>
