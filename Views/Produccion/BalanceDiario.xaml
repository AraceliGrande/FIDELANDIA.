<UserControl x:Class="FIDELANDIA.Views.Produccion.BalanceDiario"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             Background="#F5F5F5">

    <UserControl.Resources>
        <!-- Estilo moderno para TabItem -->
        <Style TargetType="TabItem">
            <Setter Property="Foreground" Value="#555"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="MinWidth" Value="200"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" 
                                CornerRadius="8,8,0,0" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="0">
                            <ContentPresenter x:Name="ContentSite"
                                              VerticalAlignment="Center" 
                                              HorizontalAlignment="Center" 
                                              ContentSource="Header"
                                              Margin="17,4"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#E5740A"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Trigger>

                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para el panel del TabControl -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="25">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Título -->
            <RowDefinition Height="*"/>
            <!-- Tabs + contenido -->
        </Grid.RowDefinitions>

        <!-- Título principal -->
        <TextBlock Text="📊 Resumen Diario" FontSize="20" FontWeight="Bold" Foreground="#E5740A" Margin="0,0,0,16"/>

        <!-- TabControl con estilo moderno -->
        <TabControl Grid.Row="1" Padding="20" BorderBrush="#D9D9D9" BorderThickness="0.5" Background="#FCFCFC">
            <!-- TAB 1 -->
            <TabItem Header="Resumen Diario">
                <Grid Margin="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="1*"/>
                        <ColumnDefinition Width="2*"/>
                    </Grid.ColumnDefinitions>
                    
                    <Border Grid.Column="0" Background="White" CornerRadius="12" Padding="20" BorderBrush="#EEE" BorderThickness="1">
                        <StackPanel>
                            <TextBlock Text="Resumen de Pastas" FontSize="15" FontWeight="Bold" Foreground="#2E2E2E" Margin="0,0,0,10"/>
                            <TextBlock Text="Seleccione un tipo de pasta para ver detalle de lotes y ventas" FontSize="10" FontWeight="Normal" Foreground="#555" TextWrapping="Wrap" Margin="0,0,0,12"/>

                            <Border Background="#F5F5F5" CornerRadius="6" Padding="2" Margin="0,0,0,12">
                                <TextBox x:Name="BuscarTextBox" FontSize="12" BorderThickness="0" VerticalContentAlignment="Center" Padding="4" TextChanged="BuscarTextBox_TextChanged"/>
                            </Border>

                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="TarjetasLotes" ItemsSource="{Binding LotesDetallePorTipo}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="White" CornerRadius="8" Padding="15" Margin="0,0,0,8"
                                                  BorderBrush="#EEE" BorderThickness="1"
                                                  Cursor="Hand" MouseLeftButtonDown="TipoPasta_Click">
                                                <StackPanel>
                                                    <TextBlock Text="{Binding TipoPasta}" FontSize="13" FontWeight="Bold" Foreground="#E5740A"/>
                                                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                        <TextBlock Text="Producción: " FontWeight="SemiBold" Foreground="#666" FontSize="10"/>
                                                        <TextBlock Text="{Binding CantidadProduccion}" Width="50" Foreground="#666" FontSize="10"/>
                                                        <TextBlock Text="Stock: " FontWeight="SemiBold" Margin="6,0,0,0" Foreground="#666" FontSize="10"/>
                                                        <TextBlock Text="{Binding Stock}" Width="50" Foreground="#666" FontSize="10"/>
                                                        <TextBlock Text="Ventas: " FontWeight="SemiBold" Margin="6,0,0,0" Foreground="#666" FontSize="10"/>
                                                        <TextBlock Text="{Binding VentasTotales}" Width="50" Foreground="#666" FontSize="10"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Column="1" Margin="20,0,20,0">
                        <!-- Gráfico -->
                        <lvc:CartesianChart x:Name="MyChart" Height="200"/>

                        <Border Grid.Column="0" Background="White" CornerRadius="12" Padding="20" BorderBrush="#EEE" BorderThickness="1">
                            <!-- Scroll de lotes -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <TextBlock Text="Detalle del tipo de lote seleccionado" FontSize="10" FontWeight="SemiBold" Foreground="#555" TextWrapping="Wrap" Margin="0,0,0,12"/>

                                    <ItemsControl ItemsSource="{Binding LotesFiltrados}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                    <StackPanel>
                                                        <!-- Datos principales del lote -->
                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,4">
                                                            <TextBlock Text="{Binding TipoPasta}" Width="120" Foreground="#2E2E2E"/>
                                                            <TextBlock Text="Lote: "/>
                                                            <TextBlock Text="{Binding IdLote}" Width="40" Foreground="#2E2E2E"/>
                                                            <TextBlock Text="Prod: "/>
                                                            <TextBlock Text="{Binding CantidadProduccion}" Width="50" Foreground="#2E2E2E"/>
                                                            <TextBlock Text="Stock: "/>
                                                            <TextBlock Text="{Binding Stock}" Width="50" Foreground="#2E2E2E"/>
                                                            <TextBlock Text="Fecha Prod: "/>
                                                            <TextBlock Text="{Binding FechaProduccion, StringFormat={}{0:dd/MM/yyyy}}" Width="80" Foreground="#2E2E2E"/>
                                                            <TextBlock Text="Vence: "/>
                                                            <TextBlock Text="{Binding FechaVencimiento, StringFormat={}{0:dd/MM/yyyy}}" Width="80" Foreground="#2E2E2E"/>
                                                        </StackPanel>

                                                        <!-- Ventas asociadas -->
                                                        <ItemsControl ItemsSource="{Binding VentasAsociadas}" Margin="12,4,0,0">
                                                            <ItemsControl.ItemsPanel>
                                                                <ItemsPanelTemplate>
                                                                    <StackPanel Orientation="Vertical"/>
                                                                </ItemsPanelTemplate>
                                                            </ItemsControl.ItemsPanel>
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border Background="#F0F4FF" CornerRadius="6" Padding="4" Margin="0,2,0,0">
                                                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                                            <TextBlock Text="L:"  Foreground="#2E2E2E"/>
                                                                            <TextBlock Text="{Binding Lote.IdLote}" Width="30"  Foreground="#2E2E2E"/>
                                                                            <TextBlock Text="Cant:" Margin="8,0,0,0"  Foreground="#2E2E2E"/>
                                                                            <TextBlock Text="{Binding Cantidad}" Width="40"  Foreground="#2E2E2E"/>
                                                                            <TextBlock Text="Fecha:" Margin="8,0,0,0"  Foreground="#2E2E2E"/>
                                                                            <TextBlock Text="{Binding Fecha, StringFormat={}{0:dd/MM/yyyy}}" Width="80"  Foreground="#2E2E2E"/>
                                                                        </StackPanel>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </StackPanel>



                    <!-- Columna derecha: panel blanco minimalista -->
                  
                </Grid>
            </TabItem>

            <!-- TAB 2 -->
            <TabItem Header="Producción y Ventas">
                <Grid>
                    <DataGrid x:Name="DataGridProduccion" ItemsSource="{Binding LotesDetalle}" AutoGenerateColumns="False" 
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                              RowHeight="28" HeadersVisibility="Column" Margin="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Tipo Pasta" Binding="{Binding TipoPasta}" Width="*"/>
                            <DataGridTextColumn Header="Lote" Binding="{Binding IdLote}" Width="60"/>
                            <DataGridTextColumn Header="Producción" Binding="{Binding CantidadProduccion}" Width="80"/>
                            <DataGridTextColumn Header="Stock" Binding="{Binding Stock}" Width="80"/>
                            <DataGridTextColumn Header="Fecha Prod" Binding="{Binding FechaProduccion, StringFormat=dd/MM/yyyy}" Width="100"/>
                            <DataGridTextColumn Header="Vence" Binding="{Binding FechaVencimiento, StringFormat=dd/MM/yyyy}" Width="100"/>
                            <DataGridTextColumn Header="Ventas Totales" Binding="{Binding VentasTotales}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <DataGrid x:Name="DataGridVentas" ItemsSource="{Binding ventasGlobal}" AutoGenerateColumns="False" 
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True"
                              RowHeight="28" HeadersVisibility="Column" Margin="0,300,0,0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Lote" Binding="{Binding Lote.IdLote}" Width="60"/>
                            <DataGridTextColumn Header="Tipo Pasta" Binding="{Binding Lote.TipoPasta.Nombre}" Width="*"/>
                            <DataGridTextColumn Header="Cantidad Vendida" Binding="{Binding Cantidad}" Width="100"/>
                            <DataGridTextColumn Header="Fecha Venta" Binding="{Binding Fecha, StringFormat=dd/MM/yyyy}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
