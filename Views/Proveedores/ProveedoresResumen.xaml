<UserControl x:Class="FIDELANDIA.Views.Proveedores.ProveedoresResumen"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf">
    <Border Background="White" CornerRadius="12" Padding="1" 
         BorderBrush="#eee" BorderThickness="1" Margin="0,0,10,0">
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled" Foreground="#333">
            <Grid Margin="5,0,5,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <!-- KPIs -->
                    <RowDefinition Height="*"/>
                    <!-- Gráficos grandes y pequeños -->
                    <RowDefinition Height="Auto"/>
                    <!-- KPIs -->
                    <RowDefinition Height="*"/>
                    <!-- Gráficos grandes y pequeños -->
                </Grid.RowDefinitions>

                <Border Background="#f0f0f0" Grid.Row="0" Margin="1,5" CornerRadius="5" Opacity="0.6" >
                    <TextBlock Text="Análisis mensual de proveedores: saldos, gastos y transacciones"
                           FontSize="10" FontWeight="Bold"
                           Foreground="#b65601"
                           Margin="10,0"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Left"/>
                </Border>


                <!-- ================= KPIs ================= -->
                <UniformGrid Columns="4" Margin="0,0,0,5" Grid.Row="1">
                    <Border Background="White" CornerRadius="16" Padding="7" Margin="3" BorderBrush="#eee" BorderThickness="1">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="Total proveedores" FontSize="11" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                            <TextBlock Text="{Binding TotalProveedores}" FontSize="19" FontWeight="Bold" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Background="White" CornerRadius="16" Padding="7" Margin="3" BorderBrush="#eee" BorderThickness="1">
                       <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="Saldo total actual (Debe)" FontSize="11" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                            <TextBlock Text="{Binding SaldoTotal, StringFormat=C}" FontSize="19" FontWeight="Bold" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                    <Border Background="White" CornerRadius="16" Padding="7" Margin="3" BorderBrush="#eee" BorderThickness="1">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="Mayor saldo (Debe)" FontSize="11" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                            <TextBlock Text="{Binding MayorSaldo, StringFormat=C}" FontSize="19" FontWeight="Bold" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>
                    <Border Background="White" CornerRadius="16" Padding="7" Margin="3" BorderBrush="#eee" BorderThickness="1">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <TextBlock Text="Proveedores criticos (Debe)" FontSize="11" Foreground="#777" FontWeight="SemiBold" TextAlignment="Center"/>
                            <TextBlock Text="{Binding TotalProveedoresCriticos}" FontSize="19" FontWeight="Bold" TextAlignment="Center"/>
                        </StackPanel>
                    </Border>

                </UniformGrid>

                <!-- ================= Gráficos: Saldo, Movimiento y Debe/Haber ================= -->
                <Grid Grid.Row="2" Margin="0">

                    <!-- Fila 0: Saldo por proveedor | Deuda por categoría -->
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="4*"/>
                            <ColumnDefinition Width="2*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Saldo por Proveedor -->
                        <Border Grid.Column="0" Background="White" CornerRadius="16" Padding="15" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Saldo por proveedor - Actualidad" FontSize="12" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding SaldoPorProveedorSeries}" Height="170" Width="550" >
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Labels="{Binding ProveedoresLabels}" ShowLabels="True" Foreground="#333"/>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Saldo" LabelFormatter="{Binding FormatoSaldo}" Foreground="#333"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>

                        <!-- Deuda por Categoría -->
                        <Border Grid.Column="1" Grid.ColumnSpan="2" Background="White" CornerRadius="16" Padding="15" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="Proporción de saldo (Debe) - Actualidad" FontSize="12" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                <lvc:PieChart Series="{Binding GastosPorCategoriaSeries}" LegendLocation="Bottom" Height="120"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>

                <UniformGrid Columns="2" Margin="0" Grid.Row="3">
                    <Border Background="White" CornerRadius="16" Padding="7" Margin="3" BorderBrush="#eee" BorderThickness="1">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Orientation="Horizontal">
                            <TextBlock Text="{Binding MesSeleccionadoTexto, StringFormat='Cantidad de transacciones en {0}:   '}" FontSize="12" Foreground="#777" FontWeight="SemiBold" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding TotalTransaccionesMes}" FontSize="12" FontWeight="Bold" VerticalAlignment="Center"/>
                        </StackPanel>

                    </Border>
                    <Border Background="White" CornerRadius="16" Padding="7" Margin="3" BorderBrush="#eee" BorderThickness="1">
                      <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="5,5,0,10" VerticalAlignment="Top">
                            <TextBlock Text="Mes:" VerticalAlignment="Center" Margin="0,0,15,0"/>
                            <ComboBox x:Name="CbMes" Width="80" SelectionChanged="CbMes_SelectionChanged" Margin="0,0,15,0">
                                <ComboBoxItem Content="Enero" Tag="1"/>
                                <ComboBoxItem Content="Febrero" Tag="2"/>
                                <ComboBoxItem Content="Marzo" Tag="3"/>
                                <ComboBoxItem Content="Abril" Tag="4"/>
                                <ComboBoxItem Content="Mayo" Tag="5"/>
                                <ComboBoxItem Content="Junio" Tag="6"/>
                                <ComboBoxItem Content="Julio" Tag="7"/>
                                <ComboBoxItem Content="Agosto" Tag="8"/>
                                <ComboBoxItem Content="Septiembre" Tag="9"/>
                                <ComboBoxItem Content="Octubre" Tag="10"/>
                                <ComboBoxItem Content="Noviembre" Tag="11"/>
                                <ComboBoxItem Content="Diciembre" Tag="12"/>
                            </ComboBox>

                            <TextBlock Text="Año:" VerticalAlignment="Center" Margin="15,0,15,0" />
                            <TextBox x:Name="TbAnio" Width="60" TextChanged="TbAnio_TextChanged" Margin="0,0,15,0" Style="{StaticResource UnderlineTextBox}"/>
                        </StackPanel>

                    </Border>
                </UniformGrid>
                <Grid Grid.Row="4">
                    <!-- Fila 1: Movimiento acumulado | Debe/Haber | Gastos por categoría -->
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="3*"/>
                            <ColumnDefinition Width="4*"/>
                            <ColumnDefinition Width="2*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Movimiento Acumulativo -->
                        <Border Grid.Column="0" Background="White" CornerRadius="16" Padding="15" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="{Binding MesSeleccionadoTexto, StringFormat='Transacciones acumulativo - {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding MovimientoAcumuladoSeries}" Height="160" Width="260">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Title="Día" Labels="{Binding DiasDelMes}" ShowLabels="False" Foreground="#333"/>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Monto Acumulado" LabelFormatter="{Binding FormatoSaldo}" Foreground="#333"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>

                        <!-- Debe/Haber por proveedor -->
                        <Border Grid.Column="1" Background="White" CornerRadius="16" Padding="15" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="{Binding MesSeleccionadoTexto, StringFormat='Debe / haber por proveedor - {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                <lvc:CartesianChart Series="{Binding DebeHaberSeries}" Height="160" Width="350">
                                    <lvc:CartesianChart.AxisX>
                                        <lvc:Axis Labels="{Binding ProveedoresLabels}" ShowLabels="True" Foreground="#333"/>
                                    </lvc:CartesianChart.AxisX>
                                    <lvc:CartesianChart.AxisY>
                                        <lvc:Axis Title="Monto" LabelFormatter="{Binding FormatoSaldo}" Foreground="#333"/>
                                    </lvc:CartesianChart.AxisY>
                                </lvc:CartesianChart>
                            </StackPanel>
                        </Border>

                        <!-- Gastos por Categoría -->
                        <Border Grid.Column="2" Background="White" CornerRadius="16" Padding="15" Margin="5" BorderBrush="#eee" BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="{Binding MesSeleccionadoTexto, StringFormat='Gastos (Debe) - {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                <lvc:PieChart Series="{Binding DeudaPorCategoriaSeries}" LegendLocation="Bottom" Height="140"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Grid>
            </Grid>
        </ScrollViewer>
    </Border>
</UserControl>
